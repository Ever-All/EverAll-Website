<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>System Status - EverAll</title>
    <!-- Link to Root CSS -->
    <link rel="preload" href="/css/styles.css" as="style" />
    <link rel="stylesheet" href="/css/styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      href="/assets/images/home-but/logoLight.png"
      type="image/x-icon"
    />
  </head>
  <body>
    <div id="buttons-placeholder" style="display: none"></div>
    <div class="gradient-image">
      <img src="/assets/images/effects/Vignette.png" alt="Gradient Image" />
    </div>
    <header class="header">
      <h2>System Status</h2>
    </header>
    <section id="privacy-main">
      <div class="container">
        <div class="status-overview">
          <div class="status-indicator">
            <span class="status-dot pending"></span>
            <span class="status-text pending">Checking System Status...</span>
          </div>
        </div>

        <div class="system-components">
          <h3>Service Status</h3>
          <div class="status-list">
            <div class="status-item" data-service="web-api">
              <span class="status-dot pending"></span>
              <span class="component-name">Web API</span>
            </div>

            <div class="status-item" data-service="discord">
              <span class="status-dot pending"></span>
              <span class="component-name">Discord Integration</span>
            </div>
          </div>
        </div>
        <div class="incident-history">
          <h3>Recent Incidents</h3>
          <p>No incidents reported in the last 7 days.</p>
        </div>
        <div class="status-footer">
          <p>
            This page auto-refreshes every 60 seconds. Last updated:
            <span id="last-updated"></span>
          </p>
          <p>For system issues or concerns, contact us at:</p>
          <p>ðŸ“§ support@ever-all.us</p>
        </div>
      </div>
    </section>
    <div id="footer-placeholder"></div>
    <script src="/js/script.js" defer></script>
    <script>
      async function checkServiceStatus() {
        const webApiEndpoint =
          "https://api.ever-all.us/api/endpoint/everall-server-health";
        const discordApiEndpoint =
          "https://api.ever-all.us/api/endpoint/everall-discord-health";

        try {
          const webApiStatus = await fetch(webApiEndpoint)
            .then((response) => response.ok)
            .catch(() => false);

          const discordStatus = await fetch(discordApiEndpoint)
            .then((response) => response.ok)
            .catch(() => false);

          // Update status dots
          const webApiDot = document.querySelector(
            '[data-service="web-api"] .status-dot'
          );
          const discordDot = document.querySelector(
            '[data-service="discord"] .status-dot'
          );
          const statusDot = document.querySelector(
            ".status-overview .status-dot"
          );
          const statusText = document.querySelector(
            ".status-overview .status-text"
          );

          webApiDot.className = `status-dot ${
            webApiStatus ? "operational" : "down"
          }`;
          discordDot.className = `status-dot ${
            discordStatus ? "operational" : "down"
          }`;

          if (webApiStatus && discordStatus) {
            statusDot.className = "status-dot full";
            statusText.className = "status-text full";
            statusText.textContent = "All Systems Online";
          } else if (!webApiStatus && !discordStatus) {
            statusDot.className = "status-dot down";
            statusText.className = "status-text down";
            statusText.textContent = "Total System Failure";
          } else {
            statusDot.className = "status-dot partial";
            statusText.className = "status-text partial";
            statusText.textContent = "Partial System Disruption";
          }
        } catch (error) {
          console.error("Error checking service status:", error);
          // On error, keep or revert to pending state
          const dots = document.querySelectorAll(".status-dot");
          dots.forEach((dot) => (dot.className = "status-dot pending"));

          const statusText = document.querySelector(
            ".status-overview .status-text"
          );
          statusText.className = "status-text pending";
          statusText.textContent = "Checking System Status...";
        }

        // Update timestamp
        const now = new Date();
        document.getElementById("last-updated").textContent =
          now.toLocaleString();
      }
      // Initial check
      checkServiceStatus();
      // Check every 60 seconds
      setInterval(checkServiceStatus, 60000);
    </script>
  </body>
</html>
